version: '3.3'

services:
  redis:
    build: ./redis
    container_name: redis_server
    command: echo never > /sys/kernel/mm/transparent_hugepage/enabled
    ports: 
      - "6379:6379"
      
  web:
    build: .
    command:  bash -c "chmod +x ./run.sh && /run.sh"
    depends_on: 
      - redis
    container_name: dj_aio_ws
    volumes:
      - .:/dj_aio_ws
    ports: 
      - "8000:8000"
  
  nginx:
    build: ./nginx
    container_name: ng_server
    depends_on:
      - web
    command: nginx -g 'daemon off;'
    ports:
      - "81:81"
    volumes:
      - ./static:/var/www/static

# docker-compose down -v --rmi all --remove-orphans (remove all docker compose)